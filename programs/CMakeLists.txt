# A function to add a program based on a name
# The name is the *.cpp basename without an extension
function(add_program filename)
  get_filename_component(name ${filename} NAME_WE)
  add_executable(${name} ${filename})
  target_link_libraries(${name} ${Boost_LIBRARIES})
  foreach(library ${ext_libraries})
    target_link_libraries(${name} ${library})
  endforeach()
  srcdirlist(directories "../src/")
  foreach(dir ${directories})
    if (cirkit_LINK_PROGRAMS_TO_STATIC)
      target_link_libraries(${name} cirkit_${dir}_static)
    else()
      target_link_libraries(${name} cirkit_${dir})
    endif()
  endforeach()
  # Link static libraries twice
  if (cirkit_LINK_PROGRAMS_TO_STATIC)
    foreach(dir ${directories})
      target_link_libraries(${name} cirkit_${dir}_static)
    endforeach()
  endif()
endfunction(add_program)

# Find all test source files and build unit tests from them
srcdirlist(directories "../src/")
foreach(dir ${directories})
  file(GLOB programs "${dir}/*.cpp")
  foreach(program ${programs})
    add_program(${program})
  endforeach()
endforeach()

srcdirlist(directories "../src/")
foreach(dir ${directories})
  foreach(adir ${addon_directories})
    file(GLOB programs ${CMAKE_SOURCE_DIR}/addons/${adir}/programs/${dir}/*.cpp)
    foreach(program ${programs})
      add_program(${program})
    endforeach()
  endforeach()
endforeach()
